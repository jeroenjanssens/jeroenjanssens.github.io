<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <link rel="icon" href="/favicon.png" type="image/png" />
    <link rel="shortcut icon" href="/favicon.ico" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Extracting text from HTML with Reporter</title>
    <meta name="viewport" content="width=device-width">
    <meta name="description" content="Dutch Data Scientist, Toolmaker, Unix Philosopher">
    <link href="/css/screen.css" media="screen, projection" rel="stylesheet" type="text/css" />
    <link rel="alternate" type="application/rss+xml" title="Jeroen Janssens" href="http://www.jeroenjanssens.com/feed.xml">

    
      <meta name="twitter:card" content="summary">
    
    <meta name="twitter:site" content="@jeroenhjanssens">
    <meta name="twitter:domain" content="jeroenjanssens.com">
    <meta name="twitter:creator" content="@jeroenhjanssens">
    
      <meta name="twitter:title" content="Extracting text from HTML with Reporter">
    
    
    <meta name="twitter:url" content="http://www.jeroenjanssens.com/2013/08/31/extracting-text-from-html-with-reporter.html">
    
    
      <meta name="twitter:description" content="Dutch Data Scientist, Toolmaker, Unix Philosopher">
    
    
      <meta name="twitter:image:src" content="http://www.jeroenjanssens.com/img/jeroenjanssens.jpg">
    
    <meta name="bitly-verification" content="f2828a63ca29"/>
  </head>
  <body>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-43246574-1', 'jeroenjanssens.com');
      ga('send', 'pageview');
    </script>
    <div id="site">
      <div id="header">
        <h1><a href="/">Jeroen Janssens</a></h1>
        <div id="description">Dutch Data Scientist, Toolmaker, Unix Philosopher</div>
        <div id="social">
          <ul>
            <li><a href="/">Consulting &amp; Training</a></li>
            <li><a href="/blog">Blog</a></li>
            <li><a href="http://datascienceatthecommandline.com">Book</a></li>
            <li><a href="http://twitter.com/jeroenhjanssens/"><img class="icon" title="Twitter" alt="Twitter" src="/img/icon-twitter.png" /></a></li>
            <li><a href="http://www.linkedin.com/in/jeroenjanssens"><img class="icon" title="LinkedIn" alt="LinkedIn" src="/img/icon-linkedin.png" /></a></li>
            <li><a href="http://github.com/jeroenjanssens/"><img class="icon" title="Github" alt="Github" src="/img/icon-github.png" /></a></li>
            <li><a href="http://www.jeroenjanssens.com/feed.xml"><img class="icon" title="RSS" alt="RSS" src="/img/icon-rss.png" /></a></li>

          <ul>
        </div>
      </div>
      <div id="content">
        					<h2>Extracting text from HTML with Reporter</h2>
					<div class="date">Published on 31 August 2013</div>
					<a href="https://twitter.com/share" class="twitter-share-button" data-via="jeroenhjanssens">Tweet</a>
					<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
					<div class="post">
						<p><em>Note: This post originally appeared on November 11, 2012 on <a href="http://visualrevenue.com/blog">Visual Revenue&#39;s blog</a>. The text from the <a href="https://github.com/visualrevenue/reporter">Github repository</a> has been appended for completeness.</em></p>

<p>At Visual Revenue, we use many great open source software packages. Our favorites include: <a href="http://www.ubuntu.com/">ubuntu</a>, <a href="http://www.vim.org/">vim</a>, <a href="http://www.gnu.org/software/emacs/">emacs</a>, <a href="http://git-scm.com/">git</a>, <a href="http://www.mongodb.org/">mongodb</a>, <a href="http://seleniumhq.org/">selenium</a>, <a href="http://redis.io/">redis</a>, <a href="http://ipython.org/">ipython</a>, <a href="http://scikit-learn.org/stable/">scikit-learn</a>, <a href="http://pandas.pydata.org/">pandas</a>, <a href="http://www.r-project.org/">R</a>, and <a href="http://d3js.org/">D3</a>. This open source tech helps us to develop a state-of-the-art recommendation platform for news editors. I&#39;m happy to announce that we can now give something back to the open source community: Reporter.</p>

<p>Reporter is being developed at <a href="http://www.visualrevenue.com">Visual Revenue, Inc.</a> where it is used to extract the main text from news articles. The name Reporter and internal terms are inspired by the news domain.</p>

<p>Reporter is a flexible tool that extracts text from HTML. At Visual Revenue, we actively use it to extract the main text from news articles. It is written in Python, which allows you to embed it in your own Python applications. You can also use Reporter from the command line.</p>

<p>In short, Reporter:</p>

<ul>
<li>  Extracts the main text from HTML.</li>
<li>  Uses a white-box scoring algorithm to determine the main text container.</li>
<li>  Can easily be extended.</li>
<li>  Supports Unicode without pain.</li>
<li>  Has awesome debugging facilities.</li>
</ul>

<p>Below, I&#39;ll explain how the scoring algorithm works.</p>

<h3>Download</h3>

<p>You can read more about Reporter on Github:
<a href="https://github.com/visualrevenue/reporter">https://github.com/visualrevenue/reporter</a>. It&#39;s also available as a PyPi package:
<a href="http://pypi.python.org/pypi/reporter/0.1.2">http://pypi.python.org/pypi/reporter/0.1.2</a>.</p>

<h3>Usage</h3>

<p>Reporter can be invoked from the command line:</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>reporter.py --url URL
</code></pre></div>
<p>The HTML from URL will be parsed by <a href="http://www.crummy.com/software/BeautifulSoup/bs4/doc/">Beautiful Soup</a> and the main
text will be printed on stdout. If the <strong>--debug</strong> flag is added, the text and HTML will be saved to file. The HTML will be styled as follows. Each tag will get a background color based on its score, ranging from red (low score) to green (high score). Moreover, the tag that is selected as news container (see below) will have a blue dashed line.</p>

<p><img src="/img/scoring.png" alt="Scoring"></p>

<p>If the <strong>--test</strong> flag is given, all files in ./test/input will be processed, and the text and HTML will be saved, as in <strong>--debug</strong>. This is useful for processing many local files, so that these only have to downloaded once. </p>

<p>Please see <strong>./reporter.py --help</strong> for more options.</p>

<p>Reporter can also be used from Python:</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">my_reporter</span> <span class="o">=</span> <span class="n">Reporter</span><span class="p">()</span>
<span class="n">my_reporter</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="s">&#39;http://example.com&#39;</span><span class="p">)</span>
<span class="k">print</span> <span class="n">my_reporter</span><span class="o">.</span><span class="n">report_news</span><span class="p">()</span>
</code></pre></div>
<h3>Scoring algorithm</h3>

<p>To extract the main text from an HTML document, Reporter gives each HTML tag (e.g., DIV, H1, and P) a score. The text contained in the tag with the highest score is returned as the main text of the news article.</p>

<p>The main part of the scoring algorithm is based on traversing the parsed HTML and works as follows. Reporter traverses the HTML in reverse order, i.e., it starts at the leaves of the DOM tree. Each tag is scored either as a paragraph or as a container. A tag is considered to be a paragraph (in the abstract sense, not in the P sense) when it contains more than 10 characters*, otherwise it is considered to be a container. The exact scoring of a tag is defined in the <strong>Autocue</strong>. An Autocue is a list of scoring rules that get triggered at various stages. For example, when a tag is to be scored as a paragraph, one rule may count the number of words and return 2 points per word. Once a tag (and its siblings) are scored, its parent is scored. If the parent is also considered to be a paragraph, which happens, for
instance, with the P tag in: </p>
<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;DIV&gt;&lt;P&gt;</span>Hello World, this is the <span class="nt">&lt;B&gt;</span>Reporter package<span class="nt">&lt;/B&gt;&lt;/P&gt;&lt;/DIV&gt;</span>
</code></pre></div>
<p>the scores of the B tag are discarded and the complete text is re-scored. The DIV tag is scored as a container because (in this case) it contains no text by itself. In fact, there is
an important scoring rule which penalises containers. If such a rule would not be included, the HTML tag would always receive the highest score, which would not be very effective. </p>

<p><em>*) Currently, this is the only heuristic that is hard-coded. In
<a href="https://github.com/gfxmonk/python-readability">Readability</a>, which served as the inspiration for Reporter, all scoring is hard-coded.</em></p>

<p>As mentioned, a scoring rule is triggered at a certain stage as the Reporter is processing the Autocue. Below, we list and explain the seven triggers with Python code. (The complete default Autocue is in <strong>autocues.py</strong>, which is easily extensible with additional rules.)</p>

<ul>
<li><p><strong>HTML</strong>, operates on the raw HTML. For example: split a paragraph with two consecutive line breaks into two paragraphs</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">default_autocue</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">RegExReplacer</span><span class="p">(</span><span class="n">pattern</span><span class="o">=</span><span class="s">&#39;&lt;br */? *&gt;[</span><span class="se">\\</span><span class="s">r</span><span class="se">\\</span><span class="s">n]\*&lt;br */? *&gt;&#39;</span><span class="p">,</span> <span class="n">repl</span><span class="o">=</span><span class="s">&#39;&lt;/p&gt;&lt;p&gt;&#39;</span><span class="p">),</span> <span class="n">HTML</span><span class="p">))</span>
</code></pre></div></li>
<li><p><strong>PRE_TRAVERSAL</strong>, scores or prunes (deletes tags) before the DOM is traversed. This is useful for getting rid of specific tags such as footers, or give positive scores to certain tags For example, delete all comments (specific to a certain news property):</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">default_autocue</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">CSSSelector</span><span class="p">(</span><span class="s">&quot;div#comments&quot;</span><span class="p">,</span> <span class="n">Pruner</span><span class="p">()),</span>
  <span class="n">PRE_TRAVERSAL</span><span class="p">))</span>
</code></pre></div></li>
</ul>

<p>Now, the HTML will be traversed as explained above.</p>

<ul>
<li><p><strong>EVAL_PARAGRAPH</strong>, scores a tag as a paragraph. For example, by counting words.</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">default_autocue</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
  <span class="p">(</span><span class="n">Scorer</span><span class="p">(</span><span class="n">RegExMatcher</span><span class="p">(</span><span class="s">&quot;(\w)+([&#39;`]\w)?&quot;</span><span class="p">,</span> <span class="n">factor</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;word&quot;</span><span class="p">),</span>
  <span class="n">reset_children</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span> <span class="n">EVAL_PARAGRAPH</span><span class="p">))</span>
</code></pre></div></li>
<li><p><strong>EVAL_CONTAINER</strong>, scores a tag as a container. For example, combining the scores of the children tags with a 70 points penalty, giving a minimal score of 0.</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">default_autocue</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
  <span class="p">(</span><span class="n">ScoreAggregator</span><span class="p">(</span><span class="n">start_score</span><span class="o">=-</span><span class="mi">70</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
  <span class="n">EVAL_CONTAINER</span><span class="p">))</span>
</code></pre></div></li>
</ul>

<p>This concludes the traversing of the HTML.</p>

<ul>
<li><strong>POST_TRAVERSAL</strong>, scores or prunes tags after Reporter has traversed the HTML. </li>
</ul>

<p>The tag with the highest score is selected as news container.</p>

<ul>
<li><p><strong>NEWS_CONTAINER</strong> is like POST_TRAVERSAL but only applies to the tag that is selected as news container.</p>

<p>Example: penalize DIVs inside the news container:</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">default_autocue</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
  <span class="p">(</span><span class="n">CSSSelector</span><span class="p">(</span><span class="s">&quot;div&quot;</span><span class="p">,</span> <span class="n">Scorer</span><span class="p">(</span><span class="n">FixedValue</span><span class="p">(</span><span class="o">-</span><span class="mi">60</span><span class="p">))),</span>
  <span class="n">NEWS_CONTAINER</span><span class="p">))</span>
</code></pre></div>
<p>Example: Get rid of any tags that have a score below -50:</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">default_autocue</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">ScoreSelector</span><span class="p">(</span><span class="n">threshold</span><span class="o">=-</span><span class="mi">50</span><span class="p">,</span> 
  <span class="n">mode</span><span class="o">=</span><span class="s">&quot;upper&quot;</span><span class="p">,</span> <span class="n">actor</span><span class="o">=</span><span class="n">Pruner</span><span class="p">()),</span> <span class="n">NEWS_CONTAINER</span><span class="p">))</span>
</code></pre></div></li>
<li><p><strong>NEWS_TEXT</strong>, operates on the text inside the news container. For example, put all text on one line:</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">default_autocue</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">RegExReplacer</span><span class="p">(</span><span class="n">pattern</span><span class="o">=</span><span class="s">&#39;\s+&#39;</span><span class="p">,</span> <span class="n">repl</span><span class="o">=</span><span class="s">&#39; &#39;</span><span class="p">),</span> <span class="n">NEWS_TEXT</span><span class="p">))</span>
</code></pre></div></li>
</ul>

<p>Now, we can return the final text as the main text of the HTML!</p>

<p>If you like what I had to say then you may want to <a href="https://twitter.com/jeroenhjanssens">follow me on Twitter</a>.</p>

					</div>

      </div>
    </div>
  </body>
</html>
